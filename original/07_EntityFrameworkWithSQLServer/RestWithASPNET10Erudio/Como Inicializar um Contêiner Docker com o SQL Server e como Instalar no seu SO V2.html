<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Como Inicializar um Cont√™iner Docker com o SQL Server - Guia Completo</title>
  <link rel="icon" href="https://github.com/leandrocgsi/blog-images/blob/main/logos/favicon-16x16-1.png?raw=true" sizes="32x32" />
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f9f9f9; color:#1f2937; line-height:1.7; }
    header { background:#363636; border-bottom:1px solid #e5e7eb; }
    .header-content { max-width:800px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; padding:20px; }
    .logo img, .stars img { max-width:200px; height:auto; }
    .main-nav { background:#fff; border-bottom:2px solid #e5e7eb; box-shadow:0 2px 4px rgba(0,0,0,0.05); position:sticky; top:0; z-index:100; }
    .nav-content { max-width:800px; margin:0 auto; display:flex; justify-content:space-around; flex-wrap:wrap; padding:0; }
    .nav-link { display:block; padding:15px 10px; text-decoration:none; color:#1f2937; font-weight:500; font-size:14px; transition:all 0.3s; border-bottom:3px solid transparent; text-align:center; }
    .nav-link:hover { color:#2563eb; border-bottom-color:#2563eb; background:#f9fafb; }
    main { max-width:800px; margin:40px auto; padding:30px 20px; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    h1 { color:#111827; font-size:28px; margin-bottom:20px; text-align:center; }
    h2 { margin-top:40px; color:#111827; }
    h3 { margin-top:25px; color:#111827; font-size:18px; }
    h4 { margin-top:15px; color:#111827; font-size:16px; }
    p { margin-bottom:18px; text-align:justify; }
    ul, ol { margin:16px 0 16px 24px; }
    li { margin-bottom:10px; }
    .highlight { background:#f3f4f6; padding:15px; border-left:4px solid #16a34a; border-radius:4px; margin:20px 0; }
    .warning { background:#fef3c7; padding:15px; border-left:4px solid #f59e0b; border-radius:4px; margin:20px 0; }
    .info { background:#dbeafe; padding:15px; border-left:4px solid #2563eb; border-radius:4px; margin:20px 0; }
    .code-block { background:#1f2937; color:#f9fafb; padding:20px; border-radius:6px; overflow-x:auto; font-family:'Courier New', monospace; font-size:14px; line-height:1.6; margin:20px 0; }
    .code-block code { display:block; white-space:pre; }
    .link-button { display:inline-block; margin:12px 8px 0 0; padding:10px 20px; background:#2563eb; color:#fff; border-radius:6px; text-decoration:none; font-size:15px; transition:background .3s; }
    .link-button:hover { background:#1d4ed8; }
    .course-banner { text-align:center; margin:40px 0 20px 0; }
    .course-banner img { border-radius:8px; box-shadow:0 3px 8px rgba(0,0,0,0.15); transition:transform .3s; max-width:100%; height:auto; }
    .course-banner img:hover { transform:scale(1.02); }
    footer { text-align:center; padding:40px 20px; background:#fff; margin-top:60px; border-top:1px solid #e5e7eb; }
    .social-icons { display:flex; flex-wrap:wrap; justify-content:center; gap:12px; padding-top:30px; }
    .social-icons a { width:52px; height:52px; background:#fff; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.15); display:flex; align-items:center; justify-content:center; transition:transform .2s; text-decoration:none; }
    .social-icons a:hover { transform:translateY(-2px); }
    .social-icons img { max-width:36px; max-height:36px; }
    #copyright-text { text-align:center; margin-top:25px; color:#4b5563; font-size:14px; }
    table { width:100%; border-collapse:collapse; margin:20px 0; }
    th, td { border:1px solid #e5e7eb; padding:12px; text-align:left; }
    th { background:#f3f4f6; }
    .repo-box { background:#f0fdf4; padding:20px; border:3px solid #16a34a; border-radius:8px; margin:30px 0; text-align:center; }
    .repo-box h3 { margin-top:0; color:#15803d; }
    .repo-link { display:inline-block; margin:15px 0; padding:15px 30px; background:#16a34a; color:#fff; border-radius:8px; text-decoration:none; font-size:18px; font-weight:bold; transition:background .3s; }
    .repo-link:hover { background:#15803d; }
  </style>
</head>
<body>
<header>
  <div class="header-content">
    <div class="logo"><a href="https://pub.erudio.com.br/kr/premium_courses"><img src="https://github.com/leandrocgsi/blog-images/blob/main/logos/cropped-teste_logo-2.png?raw=true" alt="Erudio Training"></a></div>
    <div class="stars"><img src="https://github.com/leandrocgsi/blog-images/blob/main/logos/five_stars.png?raw=true" alt="Cinco Estrelas"></div>
  </div>
</header>

<nav class="main-nav">
  <div class="nav-content">
    <a href="#introducao" class="nav-link">Introdu√ß√£o</a>
    <a href="#docker-run" class="nav-link">Docker Run</a>
    <a href="#docker-compose" class="nav-link">Docker Compose</a>
    <a href="#conexao" class="nav-link">Conex√£o</a>
    <a href="#problemas" class="nav-link">Problemas</a>
    <a href="#seguranca" class="nav-link">Seguran√ßa</a>
  </div>
</nav>

<main>
  <h1 id="introducao">Como Inicializar um Cont√™iner Docker com o SQL Server - Guia Completo</h1>

  <p>O <strong>Microsoft SQL Server</strong> √© um dos sistemas de gerenciamento de banco de dados relacionais mais utilizados no mundo corporativo. Desenvolvido pela Microsoft, ele oferece alta performance, seguran√ßa robusta e suporte a recursos avan√ßados como replica√ß√£o, transa√ß√µes distribu√≠das, integra√ß√£o com ferramentas anal√≠ticas e compatibilidade nativa com o ecossistema .NET e Azure. Neste guia completo, vamos explorar duas abordagens para trabalhar com SQL Server: executando via <strong>Docker</strong> (m√©todo recomendado para desenvolvimento) e instalando diretamente no sistema operacional (para ambientes de produ√ß√£o ou necessidades espec√≠ficas).</p>

  <h2>Por Que Usar SQL Server com Docker?</h2>

  <p>Executar o SQL Server em containers Docker oferece vantagens significativas especialmente em ambientes de desenvolvimento e testes. A principal vantagem √© a <strong>portabilidade</strong> - voc√™ pode ter inst√¢ncias isoladas do SQL Server sem interferir em outras instala√ß√µes ou no sistema operacional. Isso elimina o famoso problema de conflitos de vers√µes e configura√ß√µes.</p>

  <p>A <strong>reprodutibilidade</strong> √© outra vantagem cr√≠tica. Com um arquivo docker-compose.yml, toda a equipe de desenvolvimento pode ter exatamente o mesmo ambiente de banco de dados, com as mesmas vers√µes, configura√ß√µes e at√© mesmo dados iniciais. N√£o h√° mais aquele problema de "funciona no meu banco mas n√£o funciona no seu".</p>

  <p>O <strong>isolamento</strong> garante que diferentes projetos podem usar diferentes vers√µes do SQL Server simultaneamente na mesma m√°quina, sem conflitos. Voc√™ pode ter um projeto usando SQL Server 2019 e outro usando SQL Server 2022, ambos rodando ao mesmo tempo em containers separados.</p>

  <p>Por fim, a <strong>limpeza</strong> √© facilitada - quando voc√™ n√£o precisa mais de uma inst√¢ncia, basta remover o container. N√£o ficam arquivos espalhados pelo sistema, registros no Windows ou servi√ßos rodando em background consumindo recursos.</p>

  <h2 id="docker-run">1. Executando o SQL Server em um Cont√™iner Docker</h2>

  <p>A maneira mais pr√°tica e r√°pida de usar o SQL Server √© executando-o dentro de um cont√™iner Docker. Esse m√©todo elimina a necessidade de instala√ß√£o manual e permite isolar o banco de dados do restante do sistema. Antes de tudo, √© importante garantir que o Docker esteja instalado e em execu√ß√£o na sua m√°quina.</p>

  <h3>1.1. Verificando os Pr√©-requisitos</h3>

  <p>Antes de iniciar, verifique se o Docker est√° instalado e funcionando:</p>

  <div class="code-block"><code># Verificar vers√£o do Docker
docker --version

# Verificar se o daemon est√° rodando
docker ps</code></div>

  <p>Se esses comandos executarem sem erros, voc√™ est√° pronto para prosseguir. Caso contr√°rio, consulte a documenta√ß√£o oficial do Docker para instala√ß√£o no seu sistema operacional.</p>

  <div class="highlight">
    <p><strong>Requisitos de Hardware:</strong> O SQL Server requer no m√≠nimo 2GB de RAM. Certifique-se de que o Docker Desktop est√° configurado para usar pelo menos 4GB de RAM (recomendado 8GB para melhor performance).</p>
  </div>

  <h3>1.2. Iniciando com o Comando docker run</h3>

  <p>A forma mais direta de executar o SQL Server √© atrav√©s do comando docker run. Este m√©todo √© ideal para testes r√°pidos ou quando voc√™ precisa de uma inst√¢ncia tempor√°ria:</p>

  <div class="code-block"><code>docker run -e "ACCEPT_EULA=Y" -e "MSSQL_SA_PASSWORD=@Admin123" \
  -p 1433:1433 --name sqlserver -d \
  mcr.microsoft.com/mssql/server:2022-latest</code></div>

  <p>Vamos entender cada par√¢metro deste comando em detalhes:</p>

  <ul>
    <li><strong>docker run</strong> ‚Äì Comando principal que cria e executa um novo cont√™iner a partir de uma imagem.</li>
    <li><strong>-e "ACCEPT_EULA=Y"</strong> ‚Äì Vari√°vel de ambiente que aceita automaticamente o End-User License Agreement (EULA) da Microsoft. Este par√¢metro √© obrigat√≥rio.</li>
    <li><strong>-e "MSSQL_SA_PASSWORD=@Admin123"</strong> ‚Äì Define a senha do usu√°rio administrador do sistema (SA - System Administrator). A senha deve atender aos requisitos de complexidade do SQL Server: m√≠nimo 8 caracteres, incluindo letras mai√∫sculas, min√∫sculas, n√∫meros e s√≠mbolos.</li>
    <li><strong>-p 1433:1433</strong> ‚Äì Mapeia a porta padr√£o do SQL Server no cont√™iner (1433) para a mesma porta no host. O formato √© PORTA_HOST:PORTA_CONTAINER. Isso permite que aplica√ß√µes externas se conectem ao banco.</li>
    <li><strong>--name sqlserver</strong> ‚Äì Atribui um nome fixo ao cont√™iner, facilitando comandos futuros como stop, start, logs, etc.</li>
    <li><strong>-d</strong> ‚Äì Executa o cont√™iner em modo detached (segundo plano), liberando o terminal.</li>
    <li><strong>mcr.microsoft.com/mssql/server:2022-latest</strong> ‚Äì Especifica a imagem oficial do SQL Server 2022 hospedada no Microsoft Container Registry (MCR).</li>
  </ul>

  <h3>1.3. Verificando o Status do Cont√™iner</h3>

  <p>Ap√≥s executar o comando, aguarde alguns segundos para o SQL Server inicializar completamente. Voc√™ pode verificar o status com:</p>

  <div class="code-block"><code># Listar cont√™ineres em execu√ß√£o
docker ps

# Visualizar logs do SQL Server
docker logs sqlserver

# Seguir logs em tempo real
docker logs -f sqlserver</code></div>

  <p>Quando o SQL Server estiver pronto, voc√™ ver√° mensagens como:</p>

  <div class="code-block"><code>SQL Server is now ready for client connections.
This is an informational message; no user action is required.</code></div>

  <h3>1.4. Requisitos de Senha do SQL Server</h3>

  <div class="warning">
    <p><strong>‚ö†Ô∏è Importante - Pol√≠tica de Senhas:</strong> O SQL Server exige senhas fortes para o usu√°rio SA. A senha deve conter:</p>
    <ul>
      <li>Pelo menos 8 caracteres</li>
      <li>Letras mai√∫sculas (A-Z)</li>
      <li>Letras min√∫sculas (a-z)</li>
      <li>N√∫meros (0-9)</li>
      <li>S√≠mbolos especiais (!@#$%^&*)</li>
    </ul>
    <p>Senhas que n√£o atendem esses requisitos far√£o o container falhar ao iniciar.</p>
  </div>

  <h3 id="docker-compose">1.5. Usando o Docker Compose (M√©todo Recomendado)</h3>

  <p>Outra forma mais organizada e reprodut√≠vel de configurar o SQL Server √© atrav√©s de um arquivo <strong>docker-compose.yml</strong>. Esta abordagem √© ideal para ambientes de desenvolvimento de equipe, pois permite versionar a configura√ß√£o junto com o c√≥digo do projeto.</p>

  <p>Crie um arquivo chamado <code>docker-compose.yml</code> na raiz do seu projeto:</p>

  <div class="code-block"><code>version: '3.8'

services:
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: sqlserver
    hostname: sqlserver
    ports:
      - "1433:1433"
    environment:
      ACCEPT_EULA: "Y"
      MSSQL_SA_PASSWORD: "@Admin123"
      MSSQL_PID: "Developer"
    volumes:
      - sqlserver_data:/var/opt/mssql
      - ./init-scripts:/docker-entrypoint-initdb.d
    restart: unless-stopped
    healthcheck:
      test: /opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P "@Admin123" -Q "SELECT 1" || exit 1
      interval: 10s
      timeout: 3s
      retries: 10
      start_period: 10s

volumes:
  sqlserver_data:
    driver: local</code></div>

  <p>Detalhando cada elemento da configura√ß√£o:</p>

  <ul>
    <li><strong>version: '3.8'</strong> ‚Äì Especifica a vers√£o do formato do Docker Compose. A vers√£o 3.8 √© est√°vel e amplamente suportada.</li>
    <li><strong>services:</strong> ‚Äì Define os servi√ßos que ser√£o executados. Aqui temos apenas o SQL Server, mas poder√≠amos adicionar outros servi√ßos como Redis, RabbitMQ, etc.</li>
    <li><strong>image:</strong> ‚Äì Indica a imagem Docker oficial do SQL Server 2022.</li>
    <li><strong>container_name:</strong> ‚Äì Nome fixo do cont√™iner, facilitando identifica√ß√£o e comandos.</li>
    <li><strong>hostname:</strong> ‚Äì Define o hostname interno do cont√™iner, √∫til para comunica√ß√£o entre containers na mesma rede.</li>
    <li><strong>ports:</strong> ‚Äì Mapeamento de portas entre host e container (HOST:CONTAINER).</li>
    <li><strong>environment:</strong> ‚Äì Vari√°veis de ambiente para configura√ß√£o do SQL Server.</li>
    <li><strong>MSSQL_PID:</strong> ‚Äì Define a edi√ß√£o do SQL Server. Op√ß√µes: Developer (gratuito), Express, Standard, Enterprise.</li>
    <li><strong>volumes:</strong> ‚Äì Monta volumes para persist√™ncia de dados e scripts de inicializa√ß√£o.</li>
    <li><strong>restart: unless-stopped</strong> ‚Äì Pol√≠tica de restart autom√°tico do container.</li>
    <li><strong>healthcheck:</strong> ‚Äì Verifica periodicamente se o SQL Server est√° respondendo corretamente.</li>
  </ul>

  <h3>1.6. Iniciando com Docker Compose</h3>

  <p>Com o arquivo docker-compose.yml criado, execute:</p>

  <div class="code-block"><code># Iniciar os servi√ßos
docker compose up -d

# Verificar status
docker compose ps

# Ver logs
docker compose logs -f sqlserver

# Parar os servi√ßos
docker compose down

# Parar e remover volumes (apaga todos os dados!)
docker compose down -v</code></div>

  <h3>1.7. Persist√™ncia de Dados com Volumes</h3>

  <p>Por padr√£o, quando um container √© removido, todos os dados s√£o perdidos. Para evitar isso, usamos volumes Docker. No exemplo acima, o volume <code>sqlserver_data</code> garante que seus bancos de dados, tabelas e dados permane√ßam intactos mesmo se voc√™ remover e recriar o container.</p>

  <p>Os dados ficam armazenados em:</p>
  <ul>
    <li><strong>Linux:</strong> /var/lib/docker/volumes/</li>
    <li><strong>Windows:</strong> \\wsl$\docker-desktop-data\data\docker\volumes\</li>
    <li><strong>macOS:</strong> ~/Library/Containers/com.docker.docker/Data/</li>
  </ul>

  <h3>1.8. Scripts de Inicializa√ß√£o</h3>

  <p>Voc√™ pode automatizar a cria√ß√£o de bancos de dados, tabelas e dados iniciais colocando scripts SQL na pasta <code>init-scripts/</code>. Crie um arquivo <code>init-scripts/01-create-database.sql</code>:</p>

  <div class="code-block"><code>-- Criar banco de dados
IF NOT EXISTS (SELECT name FROM sys.databases WHERE name = 'MeuBancoDeDados')
BEGIN
    CREATE DATABASE MeuBancoDeDados;
END
GO

USE MeuBancoDeDados;
GO

-- Criar tabela de exemplo
IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'Usuarios')
BEGIN
    CREATE TABLE Usuarios (
        Id INT PRIMARY KEY IDENTITY(1,1),
        Nome NVARCHAR(100) NOT NULL,
        Email NVARCHAR(100) NOT NULL,
        DataCriacao DATETIME DEFAULT GETDATE()
    );
END
GO

-- Inserir dados de teste
INSERT INTO Usuarios (Nome, Email) VALUES 
('Jo√£o Silva', 'joao@email.com'),
('Maria Santos', 'maria@email.com');
GO</code></div>

  <h2>2. Vers√µes Dispon√≠veis do SQL Server</h2>

  <p>A Microsoft disponibiliza v√°rias vers√µes do SQL Server como imagens Docker. Aqui est√£o as principais:</p>

  <table>
    <thead>
      <tr>
        <th>Vers√£o</th>
        <th>Tag Docker</th>
        <th>Caracter√≠sticas</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>SQL Server 2022</td>
        <td>mcr.microsoft.com/mssql/server:2022-latest</td>
        <td>Vers√£o mais recente com recursos avan√ßados</td>
      </tr>
      <tr>
        <td>SQL Server 2019</td>
        <td>mcr.microsoft.com/mssql/server:2019-latest</td>
        <td>Vers√£o est√°vel e amplamente adotada</td>
      </tr>
      <tr>
        <td>SQL Server 2017</td>
        <td>mcr.microsoft.com/mssql/server:2017-latest</td>
        <td>Primeira vers√£o com suporte a Linux</td>
      </tr>
      <tr>
        <td>Azure SQL Edge</td>
        <td>mcr.microsoft.com/azure-sql-edge</td>
        <td>Vers√£o otimizada para IoT e Edge Computing</td>
      </tr>
    </tbody>
  </table>

  <h2 id="conexao">3. Conectando-se ao SQL Server</h2>

  <p>Depois que o cont√™iner estiver em execu√ß√£o, voc√™ pode se conectar usando diversos clientes SQL. Aqui est√£o as op√ß√µes mais populares:</p>

  <h3>3.1. SQL Server Management Studio (SSMS)</h3>

  <p>O <strong>SSMS</strong> √© a ferramenta oficial da Microsoft para gerenciar SQL Server. Dispon√≠vel apenas para Windows, oferece interface gr√°fica completa com recursos avan√ßados de administra√ß√£o, query design, debugging e profiling.</p>

  <p><a href="https://learn.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms" target="_blank" class="link-button">Download SSMS</a></p>

  <p>Credenciais de conex√£o:</p>
  <div class="code-block"><code>Server Type: Database Engine
Server Name: localhost,1433
Authentication: SQL Server Authentication
Login: sa
Password: @Admin123</code></div>

  <h3>3.2. Azure Data Studio</h3>

  <p>O <strong>Azure Data Studio</strong> √© uma ferramenta multiplataforma (Windows, Linux, macOS) moderna e leve, ideal para desenvolvimento. Suporta extens√µes, notebooks SQL e integra√ß√£o com Git.</p>

  <p><a href="https://azure.microsoft.com/en-us/products/data-studio/" target="_blank" class="link-button">Download Azure Data Studio</a></p>

  <h3>3.3. DBeaver</h3>

  <p>O <strong>DBeaver</strong> √© um cliente SQL universal e gratuito que suporta dezenas de bancos de dados, incluindo SQL Server. Excelente para quem trabalha com m√∫ltiplos SGBDs.</p>

  <p><a href="https://dbeaver.io/download/" target="_blank" class="link-button">Download DBeaver</a></p>

  <h3>3.4. Linha de Comando com sqlcmd</h3>

  <p>Voc√™ tamb√©m pode se conectar diretamente via terminal usando a ferramenta sqlcmd que j√° vem instalada no container:</p>

  <div class="code-block"><code># Conectar ao SQL Server dentro do container
docker exec -it sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost -U sa -P "@Admin123"

# Executar queries
1> SELECT @@VERSION;
2> GO

# Listar bancos de dados
1> SELECT name FROM sys.databases;
2> GO

# Sair
1> EXIT</code></div>

  <h3>3.5. String de Conex√£o para Aplica√ß√µes</h3>

  <p>Para conectar suas aplica√ß√µes ao SQL Server rodando no Docker, use estas connection strings:</p>

  <div class="code-block"><code># .NET (Entity Framework Core)
Server=localhost,1433;Database=MeuBancoDeDados;User Id=sa;Password=@Admin123;TrustServerCertificate=True;

# Java (JDBC)
jdbc:sqlserver://localhost:1433;databaseName=MeuBancoDeDados;user=sa;password=@Admin123;encrypt=true;trustServerCertificate=true;

# Python (pyodbc)
Driver={ODBC Driver 18 for SQL Server};Server=localhost,1433;Database=MeuBancoDeDados;UID=sa;PWD=@Admin123;TrustServerCertificate=yes;

# Node.js (mssql)
{
  server: 'localhost',
  port: 1433,
  database: 'MeuBancoDeDados',
  user: 'sa',
  password: '@Admin123',
  options: {
    encrypt: true,
    trustServerCertificate: true
  }
}</code></div>

  <h2>4. Instalando o SQL Server no Sistema Operacional</h2>

  <p>Embora o Docker seja a forma mais pr√°tica para desenvolvimento, h√° cen√°rios onde a instala√ß√£o nativa √© necess√°ria: ambientes de produ√ß√£o corporativos, requisitos de compliance, integra√ß√£o com Active Directory ou necessidade de recursos espec√≠ficos do sistema operacional.</p>

  <h3>4.1. Instala√ß√£o no Windows</h3>

  <p>No <strong>Windows</strong>, o m√©todo mais simples √© baixar o instalador oficial no site da Microsoft. O processo de instala√ß√£o √© guiado por um wizard intuitivo.</p>

  <p><a href="https://www.microsoft.com/pt-br/sql-server/sql-server-downloads" target="_blank" class="link-button">Baixar SQL Server para Windows</a></p>

  <p><strong>Edi√ß√µes dispon√≠veis:</strong></p>
  <ul>
    <li><strong>Developer Edition:</strong> Gratuita, com todos os recursos da Enterprise Edition, mas licenciada apenas para desenvolvimento e testes.</li>
    <li><strong>Express Edition:</strong> Gratuita, ideal para pequenas aplica√ß√µes. Limitada a 10GB por banco e 1GB de RAM.</li>
    <li><strong>Standard Edition:</strong> Vers√£o comercial com recursos intermedi√°rios.</li>
    <li><strong>Enterprise Edition:</strong> Vers√£o completa com todos os recursos corporativos.</li>
  </ul>

  <h3>4.2. Instala√ß√£o no Linux</h3>

  <p>O SQL Server est√° dispon√≠vel para as principais distribui√ß√µes Linux: Ubuntu, Red Hat Enterprise Linux (RHEL), SUSE Linux Enterprise Server (SLES) e containers Docker.</p>

  <p><strong>Exemplo de instala√ß√£o no Ubuntu 22.04:</strong></p>

  <div class="code-block"><code># Importar chave GPG da Microsoft
wget -qO- https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -

# Adicionar reposit√≥rio do SQL Server
sudo add-apt-repository "$(wget -qO- https://packages.microsoft.com/config/ubuntu/22.04/mssql-server-2022.list)"

# Atualizar √≠ndice de pacotes
sudo apt-get update

# Instalar SQL Server
sudo apt-get install -y mssql-server

# Executar configura√ß√£o inicial
sudo /opt/mssql/bin/mssql-conf setup

# Verificar status do servi√ßo
sudo systemctl status mssql-server</code></div>

  <h3>4.3. macOS</h3>

  <p>O <strong>macOS</strong> n√£o possui suporte nativo ao SQL Server devido a limita√ß√µes de arquitetura e licenciamento. No entanto, voc√™ tem tr√™s op√ß√µes vi√°veis:</p>

  <ul>
    <li><strong>Docker (Recomendado):</strong> Use o m√©todo descrito no in√≠cio deste guia. √â a forma mais pr√°tica e funciona perfeitamente no macOS.</li>
    <li><strong>Azure SQL Database:</strong> Utilize uma inst√¢ncia do SQL Server na nuvem Azure. Ideal para desenvolvimento com necessidade de recursos cloud.</li>
    <li><strong>VM Windows:</strong> Execute Windows em uma m√°quina virtual e instale o SQL Server normalmente.</li>
  </ul>

  <h2>5. Gerenciamento e Manuten√ß√£o</h2>

  <h3>5.1. Comandos √öteis do Docker</h3>

  <div class="code-block"><code># Parar o SQL Server
docker stop sqlserver

# Iniciar o SQL Server
docker start sqlserver

# Reiniciar o SQL Server
docker restart sqlserver

# Ver logs em tempo real
docker logs -f sqlserver

# Ver √∫ltimas 100 linhas de log
docker logs --tail 100 sqlserver

# Remover o container (dados em volumes s√£o preservados)
docker rm -f sqlserver

# Ver uso de recursos
docker stats sqlserver

# Inspecionar configura√ß√£o do container
docker inspect sqlserver

# Executar comandos dentro do container
docker exec -it sqlserver bash</code></div>

  <h3>5.2. Backup e Restore</h3>

  <p><strong>Fazer backup de um banco:</strong></p>

  <div class="code-block"><code># Criar diret√≥rio para backups no host
mkdir -p ~/sql-backups

# Fazer backup
docker exec sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost -U sa -P "@Admin123" \
  -Q "BACKUP DATABASE MeuBancoDeDados TO DISK = '/var/opt/mssql/data/MeuBancoDeDados.bak' WITH FORMAT, INIT"

# Copiar backup do container para o host
docker cp sqlserver:/var/opt/mssql/data/MeuBancoDeDados.bak ~/sql-backups/</code></div>

  <p><strong>Restaurar um banco:</strong></p>

  <div class="code-block"><code># Copiar backup do host para o container
docker cp ~/sql-backups/MeuBancoDeDados.bak sqlserver:/var/opt/mssql/data/

# Restaurar banco
docker exec sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost -U sa -P "@Admin123" \
  -Q "RESTORE DATABASE MeuBancoDeDados FROM DISK = '/var/opt/mssql/data/MeuBancoDeDados.bak' WITH REPLACE"</code></div>

  <h2 id="problemas">6. Resolu√ß√£o de Problemas Comuns</h2>

  <h3>6.1. Container N√£o Inicia</h3>

  <p><strong>Problema:</strong> O container sqlserver para imediatamente ap√≥s iniciar.</p>

  <p><strong>Solu√ß√µes:</strong></p>
  <ul>
    <li><strong>Senha fraca:</strong> Verifique se a senha atende os requisitos (8+ caracteres, mai√∫sculas, min√∫sculas, n√∫meros e s√≠mbolos)</li>
    <li><strong>Mem√≥ria insuficiente:</strong> Aumente a RAM dispon√≠vel para o Docker (m√≠nimo 2GB, recomendado 4GB)</li>
    <li><strong>Porta em uso:</strong> Verifique se outra aplica√ß√£o est√° usando a porta 1433</li>
  </ul>

  <div class="code-block"><code># Verificar logs de erro
docker logs sqlserver

# Verificar se porta est√° em uso
netstat -an | grep 1433    # Linux/macOS
netstat -an | findstr 1433  # Windows

# Testar com porta diferente
docker run -e "ACCEPT_EULA=Y" -e "MSSQL_SA_PASSWORD=@Admin123" \
  -p 1434:1433 --name sqlserver2 -d \
  mcr.microsoft.com/mssql/server:2022-latest</code></div>

  <h3>6.2. N√£o Consegue Conectar</h3>

  <p><strong>Problema:</strong> Aplica√ß√£o n√£o consegue conectar ao SQL Server.</p>

  <p><strong>Solu√ß√µes:</strong></p>

  <div class="code-block"><code># Verificar se container est√° rodando
docker ps

# Verificar se SQL Server est√° aceitando conex√µes
docker logs sqlserver | grep "ready for client connections"

# Testar conex√£o do host
docker exec sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost -U sa -P "@Admin123" -Q "SELECT @@VERSION"

# Verificar firewall (Windows)
# Permitir porta 1433 no Windows Firewall

# Verificar rede Docker
docker network inspect bridge</code></div>

  <h3>6.3. Erro de Autentica√ß√£o</h3>

  <p><strong>Problema:</strong> "Login failed for user 'sa'"</p>

  <p><strong>Solu√ß√µes:</strong></p>
  <ul>
    <li>Verifique se a senha est√° correta (case-sensitive)</li>
    <li>Adicione <code>TrustServerCertificate=True</code> na connection string</li>
    <li>Use <code>encrypt=true;trustServerCertificate=true</code> em aplica√ß√µes Java</li>
  </ul>

  <h3>6.4. Performance Baixa</h3>

  <p><strong>Problema:</strong> Queries lentas ou timeouts frequentes.</p>

  <p><strong>Solu√ß√µes:</strong></p>

  <div class="code-block"><code># Aumentar mem√≥ria dispon√≠vel
docker update --memory 4g --memory-swap 8g sqlserver

# Verificar uso de recursos
docker stats sqlserver

# Otimizar configura√ß√µes de mem√≥ria
docker exec sqlserver /opt/mssql/bin/mssql-conf set memory.memorylimitmb 3072

# Reiniciar container
docker restart sqlserver</code></div>

  <h3>6.5. Espa√ßo em Disco Cheio</h3>

  <p><strong>Problema:</strong> Volume do Docker fica sem espa√ßo.</p>

  <p><strong>Solu√ß√µes:</strong></p>

  <div class="code-block"><code># Ver uso de espa√ßo do Docker
docker system df

# Limpar recursos n√£o utilizados
docker system prune -a --volumes

# Fazer backup e limpar logs de transa√ß√£o
docker exec sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost -U sa -P "@Admin123" \
  -Q "BACKUP LOG MeuBancoDeDados TO DISK = '/var/opt/mssql/data/log_backup.trn'"

# Reduzir log de transa√ß√£o
docker exec sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost -U sa -P "@Admin123" \
  -Q "DBCC SHRINKFILE (MeuBancoDeDados_log, 1)"</code></div>

  <h2 id="seguranca">7. Boas Pr√°ticas de Seguran√ßa</h2>

  <h3>7.1. Senhas Fortes</h3>

  <p>Nunca use senhas simples como "123456" ou "password". Para ambientes de produ√ß√£o, considere usar geradores de senhas e armazenar em cofres seguros como:</p>
  <ul>
    <li>Azure Key Vault</li>
    <li>AWS Secrets Manager</li>
    <li>HashiCorp Vault</li>
    <li>Docker Secrets (para Docker Swarm)</li>
  </ul>

  <h3>7.2. N√£o Exponha Portas Desnecessariamente</h3>

  <p>Em produ√ß√£o, evite expor a porta 1433 publicamente. Use redes internas do Docker:</p>

  <div class="code-block"><code>version: '3.8'

services:
  app:
    image: minha-aplicacao
    networks:
      - app-network
    depends_on:
      - sqlserver

  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    networks:
      - app-network
    # Sem mapeamento de porta externa!
    expose:
      - "1433"
    environment:
      ACCEPT_EULA: "Y"
      MSSQL_SA_PASSWORD: "@Admin123"

networks:
  app-network:
    driver: bridge</code></div>

  <h3>7.3. Crie Usu√°rios Espec√≠ficos</h3>

  <p>Evite usar o usu√°rio SA em aplica√ß√µes. Crie usu√°rios com permiss√µes limitadas:</p>

  <div class="code-block"><code>-- Criar login
CREATE LOGIN app_user WITH PASSWORD = '@AppUser123';

-- Criar usu√°rio no banco
USE MeuBancoDeDados;
CREATE USER app_user FOR LOGIN app_user;

-- Conceder permiss√µes m√≠nimas
GRANT SELECT, INSERT, UPDATE, DELETE ON SCHEMA::dbo TO app_user;

-- Negar permiss√µes administrativas
DENY CONTROL ON DATABASE::MeuBancoDeDados TO app_user;</code></div>

  <h3>7.4. Habilite Criptografia</h3>

  <p>Para ambientes sens√≠veis, habilite TLS/SSL:</p>

  <div class="code-block"><code>version: '3.8'

services:
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    environment:
      ACCEPT_EULA: "Y"
      MSSQL_SA_PASSWORD: "@Admin123"
      MSSQL_ENABLE_HADR: "1"
      MSSQL_ENCRYPT_CONNECTIONS: "true"
    volumes:
      - ./certs:/var/opt/mssql/secrets</code></div>

  <h3>7.5. Fa√ßa Backups Regulares</h3>

  <p>Automatize backups usando cron jobs ou scripts agendados:</p>

  <div class="code-block"><code>#!/bin/bash
# backup-sqlserver.sh

BACKUP_DIR="/backups/sqlserver"
DATE=$(date +%Y%m%d_%H%M%S)
DATABASES=("MeuBancoDeDados" "OutroBanco")

for DB in "${DATABASES[@]}"; do
    docker exec sqlserver /opt/mssql-tools/bin/sqlcmd \
        -S localhost -U sa -P "@Admin123" \
        -Q "BACKUP DATABASE $DB TO DISK = '/var/opt/mssql/data/${DB}_${DATE}.bak' WITH FORMAT, INIT"
    
    docker cp sqlserver:/var/opt/mssql/data/${DB}_${DATE}.bak $BACKUP_DIR/
done

# Manter apenas √∫ltimos 7 dias de backup
find $BACKUP_DIR -name "*.bak" -mtime +7 -delete</code></div>

  <h2>8. Monitoramento e Performance</h2>

  <h3>8.1. Queries de Monitoramento</h3>

  <div class="code-block"><code>-- Verificar conex√µes ativas
SELECT 
    session_id,
    login_name,
    host_name,
    program_name,
    status,
    cpu_time,
    memory_usage
FROM sys.dm_exec_sessions
WHERE is_user_process = 1;

-- Identificar queries lentas
SELECT TOP 10
    qs.total_elapsed_time / qs.execution_count AS avg_elapsed_time,
    qs.execution_count,
    SUBSTRING(qt.text, (qs.statement_start_offset/2)+1,
        ((CASE qs.statement_end_offset
            WHEN -1 THEN DATALENGTH(qt.text)
            ELSE qs.statement_end_offset
        END - qs.statement_start_offset)/2) + 1) AS query_text
FROM sys.dm_exec_query_stats qs
CROSS APPLY sys.dm_exec_sql_text(qs.sql_handle) qt
ORDER BY avg_elapsed_time DESC;

-- Verificar uso de CPU e mem√≥ria
SELECT 
    sqlserver_start_time,
    (SELECT COUNT(*) FROM sys.dm_exec_sessions WHERE is_user_process = 1) AS user_connections,
    cpu_count,
    physical_memory_kb / 1024 / 1024 AS physical_memory_gb
FROM sys.dm_os_sys_info;

-- Ver tamanho dos bancos de dados
SELECT 
    DB_NAME(database_id) AS DatabaseName,
    SUM(size * 8 / 1024) AS SizeMB
FROM sys.master_files
GROUP BY database_id
ORDER BY SizeMB DESC;</code></div>

  <h3>8.2. Ferramentas de Monitoramento</h3>

  <p>Para ambientes corporativos, considere usar:</p>
  <ul>
    <li><strong>SQL Server Profiler:</strong> Ferramenta integrada para trace de eventos</li>
    <li><strong>Extended Events:</strong> Successor do Profiler, mais leve e eficiente</li>
    <li><strong>Azure Monitor:</strong> Para SQL Server na nuvem</li>
    <li><strong>Grafana + Prometheus:</strong> Stack open source para monitoramento</li>
    <li><strong>Datadog, New Relic:</strong> Solu√ß√µes comerciais completas</li>
  </ul>

  <h2>9. Diferen√ßas entre Edi√ß√µes</h2>

  <table>
    <thead>
      <tr>
        <th>Recurso</th>
        <th>Express</th>
        <th>Developer</th>
        <th>Standard</th>
        <th>Enterprise</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Pre√ßo</td>
        <td>Gratuito</td>
        <td>Gratuito</td>
        <td>Pago</td>
        <td>Pago</td>
      </tr>
      <tr>
        <td>Uso</td>
        <td>Produ√ß√£o limitada</td>
        <td>Apenas dev/teste</td>
        <td>Produ√ß√£o</td>
        <td>Produ√ß√£o</td>
      </tr>
      <tr>
        <td>M√°x. RAM</td>
        <td>1 GB</td>
        <td>Ilimitado</td>
        <td>128 GB</td>
        <td>Ilimitado</td>
      </tr>
      <tr>
        <td>M√°x. DB Size</td>
        <td>10 GB</td>
        <td>Ilimitado</td>
        <td>Ilimitado</td>
        <td>Ilimitado</td>
      </tr>
      <tr>
        <td>M√°x. CPUs</td>
        <td>4 cores</td>
        <td>Ilimitado</td>
        <td>24 cores</td>
        <td>Ilimitado</td>
      </tr>
      <tr>
        <td>Always On</td>
        <td>‚ùå</td>
        <td>‚úÖ</td>
        <td>‚úÖ (B√°sico)</td>
        <td>‚úÖ (Completo)</td>
      </tr>
      <tr>
        <td>Columnstore</td>
        <td>‚ùå</td>
        <td>‚úÖ</td>
        <td>‚ùå</td>
        <td>‚úÖ</td>
      </tr>
      <tr>
        <td>In-Memory OLTP</td>
        <td>‚ùå</td>
        <td>‚úÖ</td>
        <td>‚ùå</td>
        <td>‚úÖ</td>
      </tr>
    </tbody>
  </table>

  <h2>Acesse os Arquivos de Configura√ß√£o no GitHub</h2>

  <div class="repo-box">
    <h3>üì¶ C√≥digo Completo no GitHub</h3>
    <p>Todos os arquivos docker-compose.yml, scripts SQL de inicializa√ß√£o e exemplos de configura√ß√£o desta se√ß√£o est√£o dispon√≠veis no reposit√≥rio oficial do curso:</p>
    <a href="https://github.com/leandrocgsi/rest-with-spring-boot-and-java-erudio" target="_blank" class="repo-link">
      github.com/leandrocgsi/rest-with-spring-boot-and-java-erudio
    </a>
    <p style="margin-top:15px;">Procure pelo diret√≥rio <strong>docker-configs/sqlserver</strong> para ver a implementa√ß√£o completa incluindo docker-compose.yml otimizado, scripts de inicializa√ß√£o, configura√ß√µes de backup automatizado e exemplos de integra√ß√£o com aplica√ß√µes Spring Boot.</p>
  </div>

  <h2>√Årea de Membros Premium da Erudio Training</h2>

  <p>Agora que voc√™ domina SQL Server com Docker, est√° pronto para arquiteturas completas de microsservi√ßos. Na <a href="https://pub.erudio.com.br/kr/premium_courses" target="_blank" rel="noopener"><strong>√Årea de Membros Premium da Erudio Training</strong></a>, voc√™ aprende a orquestrar stacks completas com Docker Compose, implementar estrat√©gias avan√ßadas de backup e disaster recovery, configurar clusters de alta disponibilidade com Always On, integra√ß√£o com ferramentas de monitoramento como Prometheus e Grafana, e toda a infraestrutura necess√°ria para ambientes de produ√ß√£o empresariais.</p>

  <div class="course-banner">
    <a href="https://pub.erudio.com.br/kr/premium_courses" target="_blank" rel="noopener">
      <img decoding="async" title="Cursos Premium Erudio" src="https://github.com/leandrocgsi/blog-images/blob/main/00-vip-meber.png?raw=true" alt="Cursos Premium Erudio">
    </a>
  </div>

  <p style="margin-top:20px;">Aprenda a construir ambientes de banco de dados resilientes, escal√°veis e seguros, com pipelines de CI/CD automatizados, estrat√©gias de migra√ß√£o zero-downtime e monitoramento em tempo real. Domine as pr√°ticas que grandes empresas usam para manter bancos de dados cr√≠ticos operando 24/7 com SLAs de 99.99% de uptime!</p>

  <h2>Conclus√£o</h2>

  <p>Executar o SQL Server em containers Docker transformou completamente a forma como desenvolvemos aplica√ß√µes que dependem de bancos de dados Microsoft. A combina√ß√£o de portabilidade, isolamento e facilidade de uso torna o Docker a escolha ideal para ambientes de desenvolvimento e testes. Para produ√ß√£o, tanto a instala√ß√£o nativa quanto containers s√£o op√ß√µes v√°lidas, dependendo dos requisitos espec√≠ficos do seu projeto e infraestrutura.</p>

  <p>Neste guia completo, voc√™ aprendeu n√£o apenas como executar o SQL Server tecnicamente, mas como pensar estrategicamente sobre ambientes de banco de dados containerizados. Voc√™ compreendeu as diferen√ßas fundamentais entre containers e VMs, dominou tanto docker run quanto Docker Compose para gerenciamento declarativo, implementou persist√™ncia de dados com volumes Docker, configurou scripts de inicializa√ß√£o automatizados, explorou todas as edi√ß√µes dispon√≠veis e suas diferen√ßas, aprendeu a conectar com m√∫ltiplas ferramentas cliente, implementou boas pr√°ticas de seguran√ßa essenciais, configurou estrat√©gias de backup e restore, e diagnosticou e resolveu problemas comuns de forma profissional.</p>

  <div class="highlight">
    <h4 style="margin-top:0; color:#111827; font-size:18px;">‚úÖ Checklist de Conhecimentos Adquiridos</h4>
    <ul style="margin-bottom:0;">
      <li>‚úÖ Compreende as vantagens de usar SQL Server com Docker</li>
      <li>‚úÖ Sabe executar SQL Server com docker run e docker compose</li>
      <li>‚úÖ Configurou persist√™ncia de dados com volumes</li>
      <li>‚úÖ Implementou scripts de inicializa√ß√£o automatizados</li>
      <li>‚úÖ Conhece as diferen√ßas entre edi√ß√µes (Express, Developer, Standard, Enterprise)</li>
      <li>‚úÖ Conecta usando SSMS, Azure Data Studio e outras ferramentas</li>
      <li>‚úÖ Implementou senhas fortes e pol√≠ticas de seguran√ßa</li>
      <li>‚úÖ Criou usu√°rios com permiss√µes limitadas</li>
      <li>‚úÖ Configurou backup e restore automatizados</li>
      <li>‚úÖ Sabe diagnosticar problemas comuns (conex√£o, autentica√ß√£o, performance)</li>
      <li>‚úÖ Usa queries de monitoramento para an√°lise de performance</li>
      <li>‚úÖ Aplica boas pr√°ticas de seguran√ßa e manuten√ß√£o</li>
      <li>‚úÖ Compreende quando usar Docker vs instala√ß√£o nativa</li>
      <li>‚úÖ Configurou healthchecks e pol√≠ticas de restart</li>
    </ul>
  </div>

  <p>Continue praticando criando seus pr√≥prios ambientes de desenvolvimento com Docker Compose, incluindo SQL Server, suas aplica√ß√µes e outros servi√ßos necess√°rios. Experimente diferentes vers√µes do SQL Server, teste estrat√©gias de backup, configure monitoramento. E lembre-se: dominar containers √© uma habilidade essencial para o desenvolvedor moderno - n√£o apenas para bancos de dados, mas para toda a infraestrutura de aplica√ß√µes. Nos vemos na pr√≥xima se√ß√£o!</p>

  <h2>Recursos Adicionais</h2>
  <div style="margin-top:16px;">
    <a href="https://docs.microsoft.com/en-us/sql/linux/quickstart-install-connect-docker" target="_blank" class="link-button">Documenta√ß√£o Oficial Microsoft</a>
    <a href="https://hub.docker.com/_/microsoft-mssql-server" target="_blank" class="link-button">SQL Server no Docker Hub</a>
    <a href="https://learn.microsoft.com/en-us/sql/ssms/" target="_blank" class="link-button">SQL Server Management Studio</a>
    <a href="https://azure.microsoft.com/en-us/products/data-studio/" target="_blank" class="link-button">Azure Data Studio</a>
  </div>
</main>

<footer>
  <div class="social-icons">
    <a href="https://www.youtube.com/@erudiotraining" target="_blank" aria-label="YouTube">
      <img src="https://github.com/leandrocgsi/blog-images/blob/main/logos/youtube_logo_min.png?raw=true" alt="YouTube" />
    </a>
    <a href="https://www.linkedin.com/company/erudiotraining" target="_blank" aria-label="LinkedIn">
      <img src="https://github.com/leandrocgsi/blog-images/blob/main/logos/linkedin_logo_min.png?raw=true" alt="LinkedIn" />
    </a>
    <a href="https://github.com/leandrocgsi" target="_blank" aria-label="GitHub">
      <img src="https://github.com/leandrocgsi/blog-images/blob/main/logos/github_logo_min.png?raw=true" alt="GitHub" />
    </a>
    <a href="https://pub.erudio.com.br/kr/premium_courses" target="_blank" aria-label="Udemy">
      <img src="https://github.com/leandrocgsi/blog-images/blob/main/logos/udemy_logo.png?raw=true" alt="Udemy" />
    </a>
    <a href="https://www.instagram.com/erudiotraining" target="_blank" aria-label="Instagram">
      <img src="https://github.com/leandrocgsi/blog-images/blob/main/logos/instagram.png?raw=true" alt="Instagram" />
    </a>
    <a href="https://www.facebook.com/erudiotraining" target="_blank" aria-label="Facebook">
      <img src="https://github.com/leandrocgsi/blog-images/blob/main/logos/facebook.png?raw=true" alt="Facebook" />
    </a>
    <a href="https://www.threads.net/@erudiotraining" target="_blank" aria-label="Threads">
      <img src="https://github.com/leandrocgsi/blog-images/blob/main/logos/threads.png?raw=true" alt="Threads" />
    </a>
    <a href="https://www.tiktok.com/@erudiotraining" target="_blank" aria-label="TikTok">
      <img src="https://github.com/leandrocgsi/blog-images/blob/main/logos/tiktok.png?raw=true" alt="TikTok" />
    </a>
    <a href="https://x.com/erudiotraining" target="_blank" aria-label="X">
      <img src="https://github.com/leandrocgsi/blog-images/blob/main/logos/twitter.png?raw=true" alt="X (Twitter)" />
    </a>
  </div>

  <p id="copyright-text">
    ¬© Copyright - Erudio Training - 2011-<span id="current-year"></span> - CNPJ: 34.523.711/0001-62 - Todos os Direitos Reservados
  </p>

  <script>
    document.getElementById("current-year").textContent = new Date().getFullYear();
  </script>
</footer>
</body>
</html>